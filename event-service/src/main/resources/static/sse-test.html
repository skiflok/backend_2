<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>SSE Stock & Price Client</title>
    <style>
        body { font-family: sans-serif; padding: 1rem; }
        #log { white-space: pre-wrap; background: #f9f9f9; padding: 1rem; border: 1px solid #ddd; height: 300px; overflow-y: scroll; }
        button { margin-top: 1rem; margin-right: 0.5rem; }
    </style>
</head>
<body>
<h1>–¢–µ—Å—Ç SSE Client</h1>
<p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ <code>/product-stock-update-event</code> –∏ <code>/product-price-update-event</code>.</p>

<div id="log"></div>
<button id="clear">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>

<script>
    const logEl = document.getElementById('log');
    const clearBtn = document.getElementById('clear');

    function appendLog(msg) {
        const time = new Date().toLocaleTimeString();
        logEl.textContent += `[${time}] ${msg}\n`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    clearBtn.addEventListener('click', () => {
        logEl.textContent = '';
    });

    const stockUrl = 'http://localhost:9997/product-stock-update-event';
    const priceUrl = 'http://localhost:9997/product-price-update-event';

    appendLog(`–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Stock SSE: ${stockUrl}`);
    const stockSource = new EventSource(stockUrl);

    stockSource.onopen = () => appendLog('üîå Stock-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ');
    stockSource.onerror = (e) => appendLog('‚ö†Ô∏è –û—à–∏–±–∫–∞ Stock SSE: ' + (e?.message || 'connection error'));
    stockSource.onmessage = (e) => {
        appendLog('üìâ Stock –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ' + e.data);
        console.log('Stock SSE message', e);
    };

    appendLog(`–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Price SSE: ${priceUrl}`);
    const priceSource = new EventSource(priceUrl);

    priceSource.onopen = () => appendLog('üîå Price-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ');
    priceSource.onerror = (e) => appendLog('‚ö†Ô∏è –û—à–∏–±–∫–∞ Price SSE: ' + (e?.message || 'connection error'));
    priceSource.onmessage = (e) => {
        appendLog('üí∞ Price –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ' + e.data);
        console.log('Price SSE message', e);
    };
</script>
</body>
</html>
