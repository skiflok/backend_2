<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>SSE Test Client</title>
    <style>
        body { font-family: sans-serif; padding: 1rem; }
        #log { white-space: pre-wrap; background: #f9f9f9; padding: 1rem; border: 1px solid #ddd; height: 300px; overflow-y: scroll; }
        button { margin-top: 1rem; }
    </style>
</head>
<body>
<h1>–¢–µ—Å—Ç SSE Client</h1>
<p>–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ <code>/product-updates-stocks</code> –∏ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –Ω–∞ —ç–∫—Ä–∞–Ω –≤—Å–µ —Å–æ–±—ã—Ç–∏—è.</p>

<div id="log"></div>
<button id="clear">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>

<script>
    const logEl = document.getElementById('log');
    const clearBtn = document.getElementById('clear');

    function appendLog(msg) {
      const time = new Date().toLocaleTimeString();
      logEl.textContent += `[${time}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    clearBtn.addEventListener('click', () => {
      logEl.textContent = '';
    });

    // URL –≤–∞—à–µ–≥–æ SSE —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
    const sseUrl = 'http://localhost:9997/kafka-sse';

    appendLog(`–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ SSE: ${sseUrl}`);
    const es = new EventSource(sseUrl);

    es.onopen = () => appendLog('üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ');
    es.onerror = (e) => {
      appendLog('‚ö†Ô∏è –û—à–∏–±–∫–∞ SSE: ' + (e?.message || 'connection error'));
    };

    // –ï—Å–ª–∏ –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ä–∞–∑–Ω—ã–µ event names, –º–æ–∂–Ω–æ —Å–ª—É—à–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ:
    // es.addEventListener('stock-update', e => { ... });

    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å ‚Äî –ø–æ–ª—É—á–∞–µ–º –≤—Å—ë
    es.onmessage = (e) => {
      appendLog('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: ' + e.data);
      console.log('SSE message event', e);
    };
</script>
</body>
</html>
