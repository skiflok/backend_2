<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>SSE Emitter Client</title>
    <style>
        body { font-family: sans-serif; padding: 1rem; }
        #log { white-space: pre-wrap; background: #f0f0f0; padding: 1rem; border: 1px solid #ccc; height: 300px; overflow-y: auto; }
        button { margin-top: 1rem; }
    </style>
</head>
<body>
<h1>–¢–µ—Å—Ç SSE Emitter</h1>
<p>–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ <code>/kafka-sse-emitter</code> –∏ –≤—ã–≤–æ–¥–∏–º —Å–æ–±—ã—Ç–∏—è.</p>

<div id="log"></div>
<button id="clear">–û—á–∏—Å—Ç–∏—Ç—å</button>

<script>
    const logEl = document.getElementById('log');
    const clearBtn = document.getElementById('clear');

    function append(msg) {
      const time = new Date().toLocaleTimeString();
      logEl.textContent += `[${time}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    clearBtn.onclick = () => logEl.textContent = '';

    const url = 'http://localhost:9997/kafka-sse-emitter';
    append(`Connecting to ${url}`);
    const es = new EventSource(url);

    es.onopen = () => append('‚úÖ Connection opened');
    es.onerror = (e) => append('‚ùå Connection error');

    // —Å–ª—É—à–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏–º—è —Å–æ–±—ã—Ç–∏—è "message"
    es.addEventListener('message', e => {
      append('üì® Event (message): ' + e.data);
      console.log('SSEEmitter message:', e);
    });

    // —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    es.onmessage = e => {
      append('üì∞ Default onmessage: ' + e.data);
    };
</script>
</body>
</html>
